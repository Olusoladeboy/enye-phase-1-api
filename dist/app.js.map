{"version":3,"sources":["../src/app.js"],"names":["dotenv","config","app","hostname","process","env","HOSTNAME","port","PORT","defaultPath","path","join","__dirname","use","req","res","next","header","bodyParser","urlencoded","extended","limit","json","express","set","get","success","payload","message","setHeader","rateRoutes","status","error","server","listen","console","log","sayHello","_","setInterval","getConnections","err","connections","on","shutDown","connection","push","filter","curr","close","exit","setTimeout","forEach","end","destroy"],"mappings":"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","sourcesContent":["/* eslint-disable arrow-parens */\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-use-before-define */\n/* eslint-disable object-curly-newline */\n/* eslint-disable no-console */\nimport express from 'express';\nimport 'babel-polyfill';\nimport bodyParser from 'body-parser';\nimport morgan from 'morgan';\nimport dotenv from 'dotenv';\nimport cors from 'cors';\n\nimport compression from 'compression';\nimport path from 'path';\nimport helmet from 'helmet';\n\n// import routes\nimport {\n  rateRoutes } from './api';\n\ndotenv.config();\nconst app = express();\n\nconst hostname = process.env.HOSTNAME || '0.0.0.0'; // \"127.0.0.1\";\nconst port = process.env.PORT;\nconst defaultPath = path.join(__dirname, '/public');\napp.use((req, res, next) => {\n  res.header('Access-Control-Allow-Origin', '*');\n  next();\n});\napp.use(helmet());\napp.use(bodyParser.urlencoded({ extended: true, limit: '50mb' }));\napp.use(bodyParser.json({ limit: '50mb' }));\napp.use(morgan('dev'));\napp.use(cors());\napp.use(compression());\napp.use(express.static(defaultPath));\napp.set('trust proxy', true);\n\napp.get('/api', (req, res) => {\n  res.json({\n    success: true,\n    payload: [],\n    message: 'Hello, from Rates API',\n  });\n});\n\napp.use((req, res, next) => {\n  res.setHeader('Access-Control-Allow-Headers', 'X-Requested-With, Content-type');\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.setHeader('Access-Control-Allow-Credentials', 'true');\n  res.setHeader('Access-Control-Max-Age', '1800');\n  res.setHeader('Access-Control-Allow-Headers', 'Content-type');\n  res.setHeader('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, PATCH, OPTIONS');\n  next();\n});\n\n// Use Routes\napp.use('/api', rateRoutes);\n\napp.get('/api/*', (req, res) => {\n  res.status(404);\n  res.json({\n    success: false,\n    payload: null,\n    message: `ENYE API SAYS: Endpoint not found for path: ${req.path}`,\n  });\n});\n\napp.use((error, req, res, next) => {\n  res.status(error.status || 500);\n  res.json({\n    success: false,\n    payload: null,\n    message: `ENYE API SAYS: ${error.message} for path: ${req.path}`,\n  });\n  next();\n});\n\n// import { User } from \"./api/user/model\"\n// console.log(\"User==>\", User);\n\n// listen for requests\nconst server = app.listen(process.env.PORT, hostname, () => {\n  console.log(`Server running at http://${hostname}:${process.env.PORT}/`);\n});\n\napp.sayHello = _ => 'Hello ENYE!';\n\nsetInterval(() => server.getConnections((err, connections) => {\n  if (err) {\n    console.log(err);\n  }\n  console.log(`${connections} connections currently open`);\n}), 10000);\n\nprocess.on('SIGTERM', shutDown);\nprocess.on('SIGINT', shutDown);\nprocess.on('SIGQUIT', shutDown);\n\nlet connections = [];\n\nserver.on('connection', (connection) => {\n  connections.push(connection);\n  // eslint-disable-next-line no-return-assign\n  connection.on('close', () => connections = connections.filter((curr) => curr !== connection));\n});\n\nfunction shutDown() {\n  console.log('Received kill signal, shutting down gracefully');\n  server.close((err) => {\n    if (err) {\n      console.error(err);\n      process.exit(1);\n    }\n    console.log('Closed out remaining connections');\n    process.exit(0);\n  });\n\n  setTimeout(() => {\n    console.error('Could not close connections in time, forcefully shutting down');\n    process.exit(1);\n  }, 10000);\n\n  connections.forEach((curr) => curr.end());\n  setTimeout(() => connections.forEach((curr) => curr.destroy()), 5000);\n}\n\nexport default app;\n"],"file":"app.js"}
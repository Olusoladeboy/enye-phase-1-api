{"version":3,"sources":["../../../../src/api/location/city/controller.js"],"names":["module","logger","log4js","getLogger","log","req","err","error","method","user","path","message","fetchRecord","res","query","filter","skip","limit","sort","projection","population","City","find","populate","select","exec","result","info","length","createRecord","data","body","validateCreate","validate","newRecord","save","updateRecord","recordId","params","validateUpdate","findOneAndUpdate","_id","patchRecord","deleteRecord","findOneAndRemove"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-vars */\n/* eslint-disable object-curly-newline */\nimport aqp from 'api-query-params';\nimport City, { validateCreate, validateUpdate } from './model';\nimport { success, fail, safeGet, getRequestIp, log4js } from '../../../util';\nimport { STATUS_MSG } from '../../../constants';\n// import { weatherService } from '../../../services';\n\n// Logging\nconst module = 'City';\nconst logger = log4js.getLogger(`[${module}]`);\nfunction log(req, err) {\n  logger.error(`[400] [${getRequestIp(req)}] [${req.method}] [${safeGet(req.user, 'email')}] - [${req.path}], [${module}], ${err.message}`);\n}\n\nexport async function fetchRecord(req, res) {\n  const { query } = req;\n  const { filter, skip, limit, sort, projection, population } = aqp(query);\n  try {\n    const result = await City.find(filter)\n      .populate(population)\n      .skip(skip)\n      .limit(limit)\n      .sort(sort)\n      .select(projection)\n      .exec();\n    if (!result) {\n      return fail(res, 404, `${module} record not found.`);\n    }\n    logger.info(`[200] [${getRequestIp(req)}] [${req.method}] [${safeGet(req.user, 'email')}] - [${req.path}]`);\n    return success(res, 200, result, `${result.length} ${module} record(s) retrieved successfully!`);\n  } catch (err) {\n    log(req, err);\n    return fail(res, 400, `Error retrieving ${module} record. ${err.message}`);\n  }\n}\n\n// export async function fetchWeather(req, res) {\n//   const { type, city, country } = req.query;\n//   try {\n//     const result = await weatherService(type, city, country) || [];\n//     if (!result) {\n//       return fail(res, 200, 404, `${module} record not found.`);\n//     }\n//     if (result.length > 0) {\n//       return success(res, 201, result, `${module} record(s) fetched successfully!`);\n//     }\n//     return success(res, 201, [result], `${module} record(s) fetched successfully!`);\n//   } catch (err) {\n//     log(req, err);\n//     return fail(res, 400, `Error fetching ${module} record. ${err.message}`);\n//   }\n// }\n\nexport async function createRecord(req, res) {\n  const data = req.body;\n  const { error } = validateCreate.validate(data);\n  if (error) return fail(res, 422, `Error validating ${module} data. ${error.message}`);\n  const newRecord = new City(data);\n  try {\n    const result = await newRecord.save();\n    if (!result) {\n      return fail(res, 404, `${module} record not found.`);\n    }\n    return success(res, 201, result, `${module} record(s) created successfully!`);\n  } catch (err) {\n    log(req, err);\n    return fail(res, 400, `Error creating ${module} record. ${err.message}`);\n  }\n}\n\nexport async function updateRecord(req, res) {\n  const data = req.body;\n  const { recordId } = req.params;\n  const { error } = validateUpdate.validate(data);\n  if (error) return fail(res, 422, `Error validating ${module} data. ${error.message}`);\n  try {\n    const result = await City.findOneAndUpdate({ _id: recordId }, data, { new: true });\n    if (!result) {\n      return fail(res, 404, `${module} record not found.`);\n    }\n    return success(res, 200, result, `${module} record(s) updated successfully!`);\n  } catch (err) {\n    log(req, err);\n    return fail(res, 400, `Error updating ${module} record. ${err.message}`);\n  }\n}\n\nexport async function patchRecord(req, res) {\n  const data = req.body;\n  const { recordId } = req.params;\n  try {\n    const result = await City.findOneAndUpdate({ _id: recordId }, data, { new: true });\n    if (!result) {\n      return fail(res, 404, `${module} record not found.`);\n    }\n    return success(res, 200, result, `${module} record(s) patched successfully!`);\n  } catch (err) {\n    log(req, err);\n    return fail(res, 400, `Error patching ${module} record. ${err.message}`);\n  }\n}\n\nexport async function deleteRecord(req, res) {\n  const { recordId } = req.params;\n  try {\n    const result = await City.findOneAndRemove({ _id: recordId });\n    if (!result) {\n      return fail(res, 404, `${module} record not found.`);\n    }\n    return success(res, 200, result, `${module} record(s) deleted successfully!`);\n  } catch (err) {\n    log(req, err);\n    return fail(res, 400, `Error deleting ${module} record. ${err.message}`);\n  }\n}\n"],"file":"controller.js"}